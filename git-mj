#!/bin/sh

#
# git emojiï¼Œä¸€ä¸ª git çš„æ‰©å±•é›†åˆ ğŸ“¦
# åœ¨ä½ çš„ commit message ä¸­æ·»åŠ  emoji prefix
# çœ‹èµ·æ¥æ›´åŠ å¡å“‡ä¼Š
#
# é¡¹ç›®åœ°å€
#    http://github.com/octree/git-emoji
#
# Copyright 2019 Octree. All rights reserved.

# git commit message prefix
mj_init_prefix="ğŸ‰ Initial Commit. "
mj_feature_prefix="âœ¨ Feature: "
mj_bugfix_prefix="ğŸ› Bugfix: "
mj_warn_prefix="ğŸš¨ Fix Warnings: "
mj_remove_prefix="ğŸ”¥ Remove Files: "
mj_comment_prefix="ğŸ’¡ Documenting source code: "
mj_boom_prefix="ğŸ’¥ Breaking changes: "
mj_rename_prefix="ğŸšš Moving or renaming files: "
mj_deprecated_prefix="ğŸ’© Deprecation: "
mj_peformance_prefix="âš¡ï¸ Improving Performance: "
mj_tag_prefix="ğŸ”– Version Tag: "
mj_wip_prefix="ğŸš§ Work In Progress: "
mj_structure_prefix="ğŸ¨ Improving structure: "
mj_secure_prefix="ğŸ”’ Security Fix: "
mj_localize_prefix="ğŸŒ Localization: "
mj_deploy_prefix="ğŸš€ Deploy: "
mj_package_prefix="ğŸ“¦ Package: "
mj_config_prefix="ğŸ”§ Changing configuration files: "
mj_refactor_prefix="â™»ï¸ Refactoring: "
mj_test_prefix="âœ… Tests: "
mj_docker_prefix="ğŸ³ Docker: "
mj_ci_prefix="ğŸ‘· CI: "

usage() {

    echo "Usage: git mj <message-type> <message>"
    echo
    echo "Available message type are:"
    echo "init: ${mj_init_prefix}"
    echo "feature: ${mj_feature_prefix}"
    echo "bugfix: ${mj_bugfix_prefix}"
    echo "remove: ${mj_remove_prefix}"
    echo "rename: ${mj_rename_prefix}"
    echo "tag: ${mj_tag_prefix}"
    echo
    echo "'git mj type' see more message types"
    echo
    echo "ğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆğŸˆ"
}

types() {
    echo "Available message type are:"
    echo
    echo "init: ${mj_init_prefix}"
    echo "feature: ${mj_feature_prefix}"
    echo "bugfix: ${mj_bugfix_prefix}"
    echo "warn: ${mj_warn_prefix}"
    echo "remove: ${mj_remove_prefix}"
    echo "comment: ${mj_comment_prefix}"
    echo "boom: ${mj_boom_prefix}"
    echo "rename: ${mj_rename_prefix}"
    echo "deprecated: ${mj_deprecated_prefix}"
    echo "peformance: ${mj_peformance_prefix}"
    echo "tag: ${mj_tag_prefix}"
    echo "wip: ${mj_wip_prefix}"
    echo "structure: ${mj_structure_prefix}"
    echo "secure: ${mj_secure_prefix}"
    echo "localize: ${mj_localize_prefix}"
    echo "deploy: ${mj_deploy_prefix}"
    echo "package: ${mj_package_prefix}"
    echo "config: ${mj_config_prefix}"
    echo "refactor: ${mj_refactor_prefix}"
    echo "test: ${mj_test_prefix}"
    echo "docker: ${mj_docker_prefix}"
    echo "ci: ${mj_ci_prefix}"
}

main() {
    if [ $# -lt 1 ]; then
		usage
		exit 1
	fi

    if [ "$1" = "usage" ]; then
        usage
        exit 0
    elif [ "$1" = "type" ]; then
        types
        exit 0
    fi

    key="mj_$1_prefix"
    # get the prefix for message type
    prefix=$(eval echo "$"$key)

    # fatal error if message type does not exist
    if [ -z "${prefix}" ]; then
        echo "âŒ unkown message type $1"
        echo
        usage
        exit 1
    fi
    # git mj init
    if [ "$1" = "init" ]; then
        git commit -m "${prefix}"
        exit 0
    fi
    # fata error if message is missing
    if [ $# -ne 2 ]; then
        echo "âŒ message is required"
        usage
        exit 1
    fi
    # git commit
    git commit -m "${prefix}${2}"
}

main "$@"